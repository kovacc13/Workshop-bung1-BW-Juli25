<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interaktive Übung: KI-SWOT-Analyse</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" xintegrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoVBL5gI9kDXrdEMJqzUMLcAoទឹកiIA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" xintegrity="sha512-qZvrmS2ekKPF2mSznTQsxqPgnpkI4DNTlrdUmTzrDgektczlKNRRhy5X5AAOnx5S09ydFYWWNSfcEqDTTHgtNA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out;
            padding: 0 1.5rem;
        }
        .accordion-content.open {
            max-height: 500px; /* Adjust as needed */
            padding: 1rem 1.5rem;
        }
        .swot-card {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .presentation-modal {
            transition: opacity 0.3s ease-in-out;
        }
        .key-opportunity {
            box-shadow: 0 0 0 3px #fbbf24; /* amber-400 */
            transform: scale(1.03);
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        
        <header class="text-center mb-8">
            <img src="https://i.imgur.com/PKXYVWW.png" alt="Workshop Logo" class="h-12 mx-auto mb-4" onerror="this.style.display='none'">
            <h1 class="text-3xl sm:text-4xl font-bold text-slate-900">Interaktive Übung: KI-SWOT-Analyse</h1>
            <p class="text-slate-600 mt-2">Reflektieren Sie die Auswirkungen von KI auf Ihren Bereich.</p>
        </header>

        <!-- Ablauf Section -->
        <div id="ablauf" class="mb-8 bg-white rounded-xl shadow-md p-6">
            <h2 class="text-2xl font-bold text-slate-800 mb-4">Ablauf der Übung (30 Minuten)</h2>
            <div id="accordionContainer" class="space-y-2">
                <!-- Step 1-4 Accordions here -->
                <div class="border rounded-lg overflow-hidden">
                    <button class="accordion-header w-full text-left p-4 bg-slate-50 hover:bg-slate-200 transition font-semibold flex justify-between items-center">
                        <span>Schritt 1: Gruppenbildung (2 Min)</span>
                        <svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div class="accordion-content bg-white">
                        <p>Teilen Sie sich in kleine Gruppen (3-4 Personen) auf. Mischen Sie die Bereiche (bit group, schulungscenter, management etc.), um verschiedene Perspektiven zu erhalten.</p>
                    </div>
                </div>
                <div class="border rounded-lg overflow-hidden">
                    <button class="accordion-header w-full text-left p-4 bg-slate-50 hover:bg-slate-200 transition font-semibold flex justify-between items-center">
                        <span>Schritt 2: Einleitung & Analyse (3 Min)</span>
                        <svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div class="accordion-content bg-white">
                        <p>Ihre Aufgabe ist es, die Auswirkungen von KI auf Ihren Bereich zu analysieren. Nutzen Sie dafür die vier SWOT-Felder auf dem Board unten. Die Leitfragen helfen Ihnen dabei.</p>
                    </div>
                </div>
                <div class="border rounded-lg overflow-hidden">
                    <button class="accordion-header w-full text-left p-4 bg-slate-50 hover:bg-slate-200 transition font-semibold flex justify-between items-center">
                        <span>Schritt 3: Brainstorming & Auswahl (15 Min)</span>
                        <svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div class="accordion-content bg-white">
                        <p>Diskutieren Sie in der Gruppe und tragen Sie Ihre Ideen in die entsprechenden Felder ein. **Wählen Sie anschließend Ihre wichtigste Chance aus**, indem Sie auf den Stern (☆) klicken, um sie als Top-Chance zu markieren (⭐).</p>
                        <!-- Timer -->
                        <div class="mt-4 p-4 bg-slate-100 rounded-lg text-center">
                            <div id="timerDisplay" class="text-4xl font-bold text-slate-800">15:00</div>
                            <div class="flex justify-center gap-4 mt-2">
                                <button id="startTimer" class="px-4 py-2 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 transition">Start</button>
                                <button id="pauseTimer" class="px-4 py-2 bg-slate-500 text-white rounded-lg font-semibold hover:bg-slate-600 transition">Pause</button>
                                <button id="resetTimer" class="px-4 py-2 bg-slate-200 text-slate-800 rounded-lg font-semibold hover:bg-slate-300 transition">Reset</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="border rounded-lg overflow-hidden">
                    <button class="accordion-header w-full text-left p-4 bg-slate-50 hover:bg-slate-200 transition font-semibold flex justify-between items-center">
                        <span>Schritt 4: Präsentation (10 Min)</span>
                        <svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div class="accordion-content bg-white">
                        <p>Klicken Sie auf "Präsentation starten". Jede Gruppe stellt im Plenum ihre **allerwichtigste, konkreteste Chance** vor, die sie identifiziert hat.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Presentation Button -->
        <div class="text-center mb-8">
            <button id="startPresentationBtn" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-blue-700 transition-all transform hover:scale-105 disabled:bg-slate-400 disabled:cursor-not-allowed disabled:transform-none" disabled>
                Präsentation starten
            </button>
        </div>

        <!-- SWOT Board -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Strengths -->
            <div class="bg-emerald-50 border-l-4 border-emerald-500 rounded-r-lg p-4 shadow-sm">
                <h3 class="text-xl font-bold text-emerald-800">Stärken (Strengths)</h3>
                <p class="text-sm text-emerald-700 mb-3">Welche unserer bestehenden Stärken werden durch KI noch wertvoller?</p>
                <textarea id="strengths-input" class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500" placeholder="Ihre Idee hier..."></textarea>
                <button onclick="addSwotItem('strengths')" class="mt-2 w-full bg-emerald-600 text-white p-2 rounded-lg font-semibold hover:bg-emerald-700 transition">Hinzufügen</button>
                <div id="strengths-list" class="mt-4 space-y-2"></div>
            </div>
            <!-- Weaknesses -->
            <div class="bg-amber-50 border-l-4 border-amber-500 rounded-r-lg p-4 shadow-sm">
                <h3 class="text-xl font-bold text-amber-800">Schwächen (Weaknesses)</h3>
                <p class="text-sm text-amber-700 mb-3">Wo sind wir durch die KI-Entwicklung verwundbar?</p>
                <textarea id="weaknesses-input" class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-amber-500" placeholder="Ihre Idee hier..."></textarea>
                <button onclick="addSwotItem('weaknesses')" class="mt-2 w-full bg-amber-600 text-white p-2 rounded-lg font-semibold hover:bg-amber-700 transition">Hinzufügen</button>
                <div id="weaknesses-list" class="mt-4 space-y-2"></div>
            </div>
            <!-- Opportunities -->
            <div class="bg-indigo-50 border-l-4 border-indigo-500 rounded-r-lg p-4 shadow-sm">
                <h3 class="text-xl font-bold text-indigo-800">Chancen (Opportunities)</h3>
                <p class="text-sm text-indigo-700 mb-3">Welche völlig neuen Chancen ergeben sich für unser Geschäftsmodell?</p>
                <textarea id="opportunities-input" class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500" placeholder="Ihre Idee hier..."></textarea>
                <button onclick="addSwotItem('opportunities')" class="mt-2 w-full bg-indigo-600 text-white p-2 rounded-lg font-semibold hover:bg-indigo-700 transition">Hinzufügen</button>
                <div id="opportunities-list" class="mt-4 space-y-2"></div>
            </div>
            <!-- Threats -->
            <div class="bg-red-50 border-l-4 border-red-500 rounded-r-lg p-4 shadow-sm">
                <h3 class="text-xl font-bold text-red-800">Risiken (Threats)</h3>
                <p class="text-sm text-red-700 mb-3">Was sind die größten Gefahren, wenn wir nicht handeln?</p>
                <textarea id="threats-input" class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500" placeholder="Ihre Idee hier..."></textarea>
                <button onclick="addSwotItem('threats')" class="mt-2 w-full bg-red-600 text-white p-2 rounded-lg font-semibold hover:bg-red-700 transition">Hinzufügen</button>
                <div id="threats-list" class="mt-4 space-y-2"></div>
            </div>
        </div>
    </div>

    <!-- Presentation Modal -->
    <div id="presentationModal" class="presentation-modal fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col">
            <header class="p-4 border-b flex justify-between items-center gap-4">
                <h2 class="text-2xl font-bold text-slate-800">Präsentations-Chart</h2>
                <div class="flex items-center gap-2">
                    <button id="downloadPdfBtn" class="px-4 py-2 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition disabled:bg-green-300">
                        Als PDF herunterladen
                    </button>
                    <button id="closePresentationBtn" class="text-slate-500 hover:text-slate-800 text-3xl leading-none">&times;</button>
                </div>
            </header>
            <main class="p-6 overflow-y-auto" id="presentation-content">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div id="presentation-strengths"></div>
                    <div id="presentation-weaknesses"></div>
                    <div id="presentation-opportunities"></div>
                    <div id="presentation-threats"></div>
                </div>
            </main>
        </div>
    </div>


<script>
    // --- Data Store ---
    const swotData = {
        strengths: [],
        weaknesses: [],
        opportunities: [],
        threats: []
    };
    let keyOpportunityId = null;

    // --- Accordion Logic ---
    document.querySelectorAll('.accordion-header').forEach(button => {
        button.addEventListener('click', () => {
            const accordionContent = button.nextElementSibling;
            const icon = button.querySelector('svg');
            const isOpen = accordionContent.classList.contains('open');

            document.querySelectorAll('.accordion-content').forEach(content => {
                content.classList.remove('open');
                content.previousElementSibling.querySelector('svg').classList.remove('rotate-180');
            });

            if (!isOpen) {
                accordionContent.classList.add('open');
                icon.classList.add('rotate-180');
            }
        });
    });

    // --- SWOT Board Logic ---
    function addSwotItem(category) {
        const input = document.getElementById(`${category}-input`);
        const text = input.value.trim();

        if (text) {
            const id = `item-${Date.now()}`;
            swotData[category].push({ id, text });
            input.value = '';
            renderSwotLists();
            checkPresentationButtonState();
        }
    }

    function renderSwotLists() {
        for (const category in swotData) {
            const listContainer = document.getElementById(`${category}-list`);
            listContainer.innerHTML = '';
            swotData[category].forEach(item => {
                const card = document.createElement('div');
                card.className = 'swot-card bg-white p-3 rounded-lg shadow-sm flex justify-between items-center transition-all duration-300';
                card.dataset.id = item.id;

                const textSpan = document.createElement('span');
                textSpan.textContent = item.text;
                textSpan.className = 'flex-grow mr-2';
                card.appendChild(textSpan);

                if (category === 'opportunities') {
                    const button = document.createElement('button');
                    button.onclick = () => setKeyOpportunity(item.id);

                    if (item.id === keyOpportunityId) {
                        card.classList.add('key-opportunity');
                        button.textContent = '⭐';
                        button.title = 'Dies ist die Top-Chance';
                        button.className = 'ml-2 text-2xl text-amber-400 transform scale-125';
                    } else {
                        button.textContent = '☆';
                        button.title = 'Als Top-Chance markieren';
                        button.className = 'ml-2 text-2xl text-slate-400 hover:text-amber-400 transition-transform transform hover:scale-125';
                    }
                    card.appendChild(button);
                }
                listContainer.appendChild(card);
            });
        }
    }
    
    function setKeyOpportunity(id) {
        keyOpportunityId = id;
        renderSwotLists();
        checkPresentationButtonState();
    }

    function checkPresentationButtonState() {
        const presentationBtn = document.getElementById('startPresentationBtn');
        presentationBtn.disabled = !keyOpportunityId;
    }

    // --- Presentation Modal Logic ---
    const startBtn = document.getElementById('startPresentationBtn');
    const closeBtn = document.getElementById('closePresentationBtn');
    const modal = document.getElementById('presentationModal');
    const downloadBtn = document.getElementById('downloadPdfBtn');

    startBtn.addEventListener('click', () => {
        renderPresentationChart();
        modal.classList.remove('hidden');
    });

    closeBtn.addEventListener('click', () => {
        modal.classList.add('hidden');
    });
    
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.classList.add('hidden');
        }
    });

    function renderPresentationChart() {
        const containers = {
            strengths: document.getElementById('presentation-strengths'),
            weaknesses: document.getElementById('presentation-weaknesses'),
            opportunities: document.getElementById('presentation-opportunities'),
            threats: document.getElementById('presentation-threats')
        };
        const titles = {
            strengths: { text: 'Stärken', color: 'emerald' },
            weaknesses: { text: 'Schwächen', color: 'amber' },
            opportunities: { text: 'Chancen', color: 'indigo' },
            threats: { text: 'Risiken', color: 'red' }
        };

        for (const category in containers) {
            const container = containers[category];
            container.innerHTML = '';
            
            const title = document.createElement('h3');
            title.className = `text-2xl font-bold text-${titles[category].color}-800 border-b-2 border-${titles[category].color}-500 pb-2 mb-4`;
            title.textContent = titles[category].text;
            container.appendChild(title);

            const list = document.createElement('ul');
            list.className = 'space-y-3';
            swotData[category].forEach(item => {
                const listItem = document.createElement('li');
                listItem.className = 'bg-slate-100 p-3 rounded-lg shadow-sm transition-all';
                listItem.textContent = item.text;
                if (item.id === keyOpportunityId) {
                    listItem.classList.add('bg-amber-300', 'ring-4', 'ring-amber-500', 'font-bold', 'scale-105');
                    listItem.innerHTML = `<span class="mr-2">⭐</span> ${item.text}`;
                }
                list.appendChild(listItem);
            });
            container.appendChild(list);
        }
    }

    // --- PDF Download Logic ---
    async function downloadPdf() {
        const downloadButton = document.getElementById('downloadPdfBtn');
        const originalButtonText = downloadButton.innerHTML;
        downloadButton.innerHTML = 'Wird erstellt...';
        downloadButton.disabled = true;
    
        const { jsPDF } = window.jspdf;
        const contentToCapture = document.getElementById('presentation-content');
        const logoUrl = 'https://i.imgur.com/PKXYVWW.png';
        const exerciseTitle = 'KI-SWOT-Analyse - Workshop'; // UPDATED TITLE
    
        try {
            // 1. Create PDF instance
            const pdf = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4'
            });
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const margin = 15;
            let currentY = margin;

            // 2. Add Logo from URL
            const response = await fetch(logoUrl, { mode: 'cors' }); // Use CORS mode
            const blob = await response.blob();
            const logoBase64 = await new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(blob);
            });
            
            const img = new Image();
            img.src = logoBase64;
            await new Promise(resolve => { img.onload = resolve });
            
            const logoHeight = 15; 
            const logoWidth = (img.width * logoHeight) / img.height;
            const logoX = (pdfWidth - logoWidth) / 2;
            pdf.addImage(logoBase64, 'PNG', logoX, currentY, logoWidth, logoHeight);
            currentY += logoHeight + 10;

            // 3. Add Title
            pdf.setFontSize(20);
            pdf.setFont('helvetica', 'bold');
            pdf.setTextColor(44, 62, 80); // Dark slate color
            pdf.text(exerciseTitle, pdfWidth / 2, currentY, { align: 'center' });
            currentY += 10;

            // 4. Add Creation Date
            const today = new Date();
            const dateString = `Erstellt am: ${today.toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', year: 'numeric' })}`;
            pdf.setFontSize(10);
            pdf.setFont('helvetica', 'normal');
            pdf.setTextColor(100, 116, 139); // Slate-500 color
            pdf.text(dateString, pdfWidth - margin, currentY, { align: 'right' });
            currentY += 10;

            // 5. Add SWOT content from canvas
            const canvas = await html2canvas(contentToCapture, { 
                scale: 2,
                backgroundColor: '#ffffff',
                useCORS: true 
            });
            
            const imgData = canvas.toDataURL('image/png');
            const canvasRatio = canvas.width / canvas.height;
            const contentWidth = pdfWidth - (margin * 2);
            const contentHeight = contentWidth / canvasRatio;

            pdf.addImage(imgData, 'PNG', margin, currentY, contentWidth, contentHeight);
            
            // 6. Save the PDF
            pdf.save('KI-SWOT-Analyse.pdf');

        } catch (error) {
            console.error("PDF-Erstellung fehlgeschlagen:", error);
            alert("Entschuldigung, das PDF konnte nicht erstellt werden. Möglicherweise blockiert Ihr Browser das Laden von externen Bildern.");
        } finally {
            downloadButton.innerHTML = originalButtonText;
            downloadButton.disabled = false;
        }
    }

    downloadBtn.addEventListener('click', downloadPdf);


    // --- Timer Logic ---
    let timerInterval;
    let timeInSeconds = 15 * 60; // Adjusted to 15 minutes
    const timerDisplay = document.getElementById('timerDisplay');
    const startTimerBtn = document.getElementById('startTimer');
    const pauseTimerBtn = document.getElementById('pauseTimer');
    const resetTimerBtn = document.getElementById('resetTimer');

    function updateTimerDisplay() {
        const minutes = Math.floor(timeInSeconds / 60);
        const seconds = timeInSeconds % 60;
        timerDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    function startTimer() {
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            if (timeInSeconds > 0) {
                timeInSeconds--;
                updateTimerDisplay();
            } else {
                clearInterval(timerInterval);
                timerDisplay.textContent = "Zeit abgelaufen!";
                timerDisplay.classList.add('text-red-600');
            }
        }, 1000);
    }

    function pauseTimer() {
        clearInterval(timerInterval);
    }

    function resetTimer() {
        clearInterval(timerInterval);
        timeInSeconds = 15 * 60; // Adjusted to 15 minutes
        timerDisplay.classList.remove('text-red-600');
        updateTimerDisplay();
    }

    startTimerBtn.addEventListener('click', startTimer);
    pauseTimerBtn.addEventListener('click', pauseTimer);
    resetTimerBtn.addEventListener('click', resetTimer);

    // Initial setup
    updateTimerDisplay();
    checkPresentationButtonState();

</script>

</body>
</html>
